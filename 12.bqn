str â† â€¢Import "util/strings.bqn"

lines â† â€¢FLines "input12"

# rename: .=0, #=1, ?=2
records â† ({ğ•©='.'?0;ğ•©='#'?1;2}Â¨ âŠâŸœâŸ¨' 'âŸ©âŠ¸â†‘)Â¨ lines
counts â† (str.ToNats âŠâŸœâŸ¨' 'âŸ©âŠ¸â†“)Â¨ lines

# from bqncrate
Binary â† 2{âŒ½ğ•—|âŒŠâˆ˜Ã·âŸœğ•—âŸ(â†•1+Â·âŒŠğ•—â‹†â¼1âŒˆâŠ¢)} # natural number to binary
Onelen â† {-ËœËË˜âˆ˜â€¿2â¥Š/0(âˆ¾â‰ âˆ¾Ëœ) ğ•©}      # counts of consecutive ones

ns â† (+Â´ 2âŠ¸=)Â¨ records             # numbers of ?'s
subs â† {((-ğ•©)â†‘Binary)Â¨ â†•2â‹†ğ•©}Â¨ ns   # all possible substitutions

# Insert a substitution (ğ•©) into record (ğ•¨)
# TODO: messy
Possible â† {ğ•¨ {ğ•¨=2 ? ğ•© ; ğ•¨}Â¨ (â‰ ğ•¨)â†‘/â¼ â‰¥âŸœ0âŠ¸/ ğ•© {ğ•¨=0 ? -1 ; ğ•©}Â¨ / ğ•¨=2}

# Check each possible substitution against the correct counts
correct â† counts {ğ•¨âŠ¸â‰¡Â¨ ğ•©}Â¨ OnelenÂ¨Â¨ records {ğ•¨âŠ¸PossibleÂ¨ ğ•©}Â¨ subs

# Result: Number of matching substitutions
â€¢Show +Â´âˆ¾ correct
